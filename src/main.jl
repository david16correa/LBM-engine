include("preamble.jl")
include("structs.jl")
include("aux.jl")
include("functions.jl")

#= ==========================================================================================
=============================================================================================
main
=============================================================================================
========================================================================================== =#

cs = [[0,0], 
      [1, 0],
      [-1, 0],
      [0, 1],
      [0, -1],
      [1, 1],
      [-1, 1],
      [1, -1],
      [-1, -1]]
ws = [4/9, 1/9, 1/9, 1/9, 1/9, 1/36, 1/36, 1/36, 1/36]
D2Q9 = [LBMvelocity(cs[i], ws[i]) for i in eachindex(cs)] 

model = modelInit(D2Q9; τ = 1.);

@time for _ in 1:101
    LBMpropagate!(model);
end

#= ==========================================================================================
=============================================================================================
misc
=============================================================================================
========================================================================================== =#

t = 101
ρ = massDensity(model; time = t);
fig, ax, hm = heatmap(ρ, 
    axis=(
        title = "mass density, t = $(model.time[t])",
    )
);
Colorbar(fig[1,2], hm);
fig

